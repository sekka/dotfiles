---
description: 指定ファイルのコードレビュー
argument-hint: [対象ファイルまたはディレクトリ]
---

# コードレビュー

対象: $ARGUMENTS

## 実行内容

### Step 1: 概要把握

- 変更の目的を理解
- 変更されたファイルの一覧を確認
- 関連する Issue や PR の説明を確認

### Step 2: コードレビュー

以下の観点でレビュー：

#### 正確性

- [ ] ロジックが正しいか
- [ ] エッジケースが考慮されているか
- [ ] エラーハンドリングが適切か
- [ ] null/undefined の扱いが安全か

#### セキュリティ

- [ ] インジェクション攻撃（SQL、XSS、コマンドインジェクション）の脆弱性がないか
- [ ] 入力値のバリデーションとサニタイゼーションが適切か
- [ ] 認証/認可の実装が正しいか
- [ ] 機密データ露出リスクがないか（ハードコーディング、ログ出力等）
- [ ] 安全でない依存関係や設定がないか
- [ ] 暗号化実装が適切か（弱いアルゴリズムの使用等）
- [ ] OWASP Top 10 等の一般的なセキュリティリスクに対応しているか

#### パフォーマンス

- [ ] パフォーマンスのボトルネックがないか
- [ ] 非効率なアルゴリズムや不要な計算がないか
- [ ] データベース操作での N+1 クエリ問題がないか
- [ ] 不要なメモリ割り当てとメモリリークがないか
- [ ] アルゴリズムの時間的・空間的複雑さが適切か
- [ ] 適切なリソースクリーンアップが行われているか
- [ ] 不要な再レンダリングがないか（フロントエンド）

#### 保守性

- [ ] コードが読みやすいか
- [ ] 命名が適切か
- [ ] 適切な抽象化レベルか
- [ ] 重複コードがないか
- [ ] コメントが適切か（過不足なく）

#### テスタビリティ

- [ ] テストが追加されているか
- [ ] テストカバレッジは十分か
- [ ] テストが保守しやすいか

#### エラーハンドリングとロバストネス

- [ ] 包括的なエラー処理が実装されているか
- [ ] 適切な例外伝播が行われているか
- [ ] 適切なロギングが行われているか
- [ ] エラーメッセージが情報的だが安全か（機密情報を含まない）
- [ ] 段階的な劣化とフォールバック戦略があるか

#### ドキュメントとコメント

- [ ] 適切なコメントとドキュメントがあるか
- [ ] 複雑なロジックの説明があるか
- [ ] API ドキュメントが完全か
- [ ] コメントが実装と一致しているか（コメント腐敗がないか）

#### 設計

- [ ] SOLID 原則に従っているか
- [ ] 既存のアーキテクチャに沿っているか
- [ ] 依存関係の方向が適切か
- [ ] 適切な抽象化レベルか

### Step 3: 自己確認（レポート作成前）

レポートを完成させる前に以下を確認：

- [ ] すべての主要な品質側面（正確性、セキュリティ、パフォーマンス、保守性、エラーハンドリング、テスタビリティ、ドキュメント）をチェックしたか？
- [ ] 特定されたすべての問題は有効で正確に記述されているか？
- [ ] 実行可能な推奨事項を提供しているか？
- [ ] 重大度の分類は適切か？
- [ ] 問題だけでなく、良い実践も認識したか？
- [ ] 具体的な行番号、関数名、またはコードスニペットを参照しているか？

### Step 4: レビュー結果の報告

```markdown
## レビュー結果

### サマリー

- 全体的な印象
- 品質スコア: A/B/C/D/F（任意）
- 特に良かった点
- 改善が必要な点の概要

### 🔴 重大な問題（Critical Issues）

[修正が必須の問題 - セキュリティ脆弱性、バグ、データ損失リスク]
[具体的な行番号、関数名、コードスニペットを参照]

### 🟡 重要な問題（Important Issues）

[修正すべき問題 - パフォーマンス問題、保守性の懸念、設計上の問題]

### 🟢 改善提案（Suggestions）

[あると良い改善 - スタイル改善、マイナーな最適化]

### 💡 その他の観察（Observations）

[追加のメモや学習の機会、代替アプローチ]

### ✅ 良い点（Positive Aspects）

[よくできている点を強調 - 良い実践を奨励するため]

### 詳細（オプション）

| #   | ファイル | 行  | 種別 | 重要度 | 指摘内容 | 提案 |
| --- | -------- | --- | ---- | ------ | -------- | ---- |
| 1   | xxx.ts   | 42  | バグ | 高     | ...      | ...  |
| 2   | yyy.ts   | 15  | 改善 | 中     | ...      | ...  |
| 3   | zzz.ts   | 8   | 質問 | 低     | ...      | ...  |

### 推奨アクション

[優先順位付けされた推奨アクションのリスト]
```

## レビューコメントの書き方

### 良いコメントの例

```markdown
<!-- 具体的な理由と改善案を示す -->

この条件分岐では `user` が null の場合を考慮していません。
`user?.name` のようにオプショナルチェーンを使うか、
事前に null チェックを追加することを推奨します。

<!-- コードの意図を確認する -->

この処理を同期的に行っている理由はありますか？
非同期にすることでパフォーマンスが改善できる可能性があります。
```

### 避けるべきコメント

```markdown
<!-- 曖昧すぎる -->

❌ "ここは良くない"

<!-- 具体的な改善案がない -->

❌ "これはリファクタリングすべき"

<!-- 上から目線 -->

❌ "こんなコードを書くべきではない"
```

## 重要度の基準

| 重要度 | 基準                                       | 対応     |
| ------ | ------------------------------------------ | -------- |
| 高     | バグ、セキュリティ問題、データ損失の可能性 | 必須修正 |
| 中     | パフォーマンス問題、保守性の低下           | 強く推奨 |
| 低     | コードスタイル、軽微な改善                 | 任意     |

## レビューガイドライン

1. **コンテキストを理解する**: コードは何を達成しようとしているか？どのような問題を解決するか？
2. **実装を検証する**: コードを注意深く読み、ロジックフローを追跡する
3. **標準に照らし合わせる**: プロジェクト固有のコーディング標準（CLAUDE.md など）と比較する
4. **具体的に**: 問題を特定する際は、常に正確な行番号、関数名、またはコードスニペットを参照する
5. **解決策を提供**: 問題を特定するだけでなく、役立つ場合はコード例を含めた具体的な修正を提案する
6. **影響によって優先順位付け**: 最も高いリスクまたはビジネス影響を持つ問題に最初に焦点を当てる
7. **徹底的に、しかし焦点を当てて**: 明示的に求められない限り、最近書かれた/変更されたコードに焦点を当てる
8. **既存のパターンを尊重**: プロジェクトのパターンと慣習を考慮する
9. **バランスを取る**: 批判と良い実践の認識のバランスを取る
10. **「理由」を説明**: フィードバックの背後にある理由を説明して学習を促進する
11. **誤検知を避ける**: 本物の問題のみをフラグ付けする。些細なことで具体的に求められない限りノイズを作らない
12. **建設的に**: フィードバックは建設的かつプロフェッショナルに保つ
13. **不確かさを認める**: 何かについて不確かな場合は、推測するのではなく、そう言う

## 注意事項

- 批判ではなく継続的な改善を目標とする
- 良い点も積極的に伝える
- 「なぜ」を説明し、学びの機会を提供する
- 緊急でない指摘は nitpick として明示する
- 全体の文脈を理解してからレビューする
- 開発者がより良いコードを書くのを助けることに焦点を当てる
