# 共通ルール

## 自律的な作業の制限

私の指示なく、以下の作業を行わない:

- Git コミット
- GitHub にプッシュ

## 技術調査のガイドライン

### 基本フロー（デシジョンツリー）

実装やデバッグ中にエラーや不明点が発生した場合、以下のツールを自発的に使用すること：

1. **公式ドキュメント優先**

   - Context7: ライブラリ公式ドキュメント、API 仕様、ベストプラクティス
   - Claude Code Guide: Claude Code 自身の機能・仕様調査（自己参照的な質問）

2. **補足情報**

   - DeepWiki: CHANGELOG、既知の問題、内部実装の理解
   - WebFetch: npm trends、Moiva.io（パッケージ比較、トレンド）

3. **複雑な比較**
   - 5 つ以上のライブラリ詳細比較 → evaluating-tools スキルの使用を検討

### セキュリティ原則

- 環境変数、API キー、顧客データなどの機密情報を外部ツールに送信禁止
- Context7/DeepWiki 使用時は、公開情報のみを問い合わせ対象とする
- 送信前に機密情報が含まれていないか確認する

## コード実装のワークフロー

### 実装の 4 段階アプローチ

コードの品質を高めるため、以下の段階的なワークフローを推奨する：

#### 0. 開始前：要件の明確化（AskUserQuestion）

- **使用ツール**: `AskUserQuestion`
- **目的**: 曖昧な要件を明確化、優先順位の確認、制約条件の把握
- **タイミング**: ユーザーのリクエストが曖昧な場合、実装前に必ず実施
- **注意**: 自明な質問は避け、ユーザー自身が言語化していない前提を引き出す

#### 1. 実装前：設計方針の相談

- **使用ツール**: `/ask-peer` スキル
- **目的**: 設計判断、アーキテクチャ選択、トレードオフ評価
- **タイミング**: 実装を開始する前、複数のアプローチで迷ったとき
- **注意**: Peer の意見を鵜呑みにせず、複数の視点（Main、Peer、ユーザー）を総合的に評価する

#### 2. 実装中：リアルタイムチェック

- **使用ツール**: `/reviewing-with-claude` スキル
- **目的**: コーディング中の軽微な確認、セキュリティチェック
- **タイミング**: 実装中、随時
- **注意**: 小規模な変更向け。現在のセッションコンテキストを活用

#### 3. 実装後：包括的レビュー

- **使用ツール**: `/reviewing-parallel` スキル
- **目的**: 複数 AI による多角的な品質評価（セキュリティ、パフォーマンス、保守性）
- **タイミング**: 実装完了後、PR 作成前
- **注意**: 4 つの AI 並列実行のため時間がかかる。重要な変更に使用

### ワークフロー判断ツリー

```
実装タスク開始
  ↓
ユーザーのリクエストは明確？
  NO  → AskUserQuestionで要件明確化
  YES → 次へ
  ↓
設計判断が必要？
  YES → /asking-peer で相談（内部でAskUserQuestion使用）→ 方針決定
  NO  → 直接実装開始
  ↓
実装実行
  ↓（随時）
不安な箇所がある？
  YES → /reviewing-with-claude で確認
  NO  → 実装継続
  ↓
実装完了
  ↓
重要な変更？
  YES → /reviewing-parallel で包括レビュー
  NO  → /reviewing-with-claude で軽量レビュー
  ↓
コミット・PR作成
```

### AI 相談の原則

複数の AI（Peer、Reviewer 等）を活用する際の原則：

1. **鵜呑みにしない**: AI の提案を無批判に受け入れず、常に検証する
2. **複数視点の統合**: Main Claude、Peer、外部 Reviewer、ユーザー自身の判断を総合評価
3. **適材適所**: 軽微な判断に重量級ツールを使わない（コスト・時間の無駄）
4. **最終判断は人間**: AI はあくまで補助。責任ある判断はユーザーが行う

### AskUserQuestion の使用方針

Claude Code は`AskUserQuestion`ツールを使い、ユーザーに選択肢形式で質問できる。これを積極的に活用すること：

#### 使用すべき場面

1. **曖昧な要件**: ユーザーのリクエストが不明確な場合

   - 例: "パフォーマンスを改善して" → 何を優先？メモリ？速度？起動時間？

2. **優先順位の確認**: トレードオフがある場合

   - 例: パフォーマンス vs 可読性、開発速度 vs 品質

3. **制約条件の把握**: 暗黙の前提を明確化

   - 例: 納期、チームスキル、既存システムとの互換性

4. **最終判断の委譲**: AI が勝手に決めず、ユーザーに選択させる
   - 例: "オプション A（推奨）とオプション B があります。どちらにしますか？"

#### 効果的な質問の条件

- **選択肢は 2-4 個**: 多すぎると選択負担が増える
- **自明でない**: "良いコードを書きたいですか？"のような質問は避ける
- **具体的**: ユーザーが判断できる具体性を持つ
- **multiSelect 活用**: 複数選択が適切な場合は`multiSelect: true`を使用

#### 避けるべき質問

- 専門的すぎてユーザーが答えられない質問
- はい/いいえだけで答えられる単純な質問（選択肢として不十分）
- AI が自分で判断できる技術的詳細（ユーザーに負担をかけない）
