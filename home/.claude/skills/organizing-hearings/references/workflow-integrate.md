# ワークフロー2: クライアント資料からの情報統合

## 概要

クライアントから提供された資料（画像、PDF、プレゼンテーション）から情報を抽出し、
既存の整理文書に統合するワークフロー。
既存情報との整合性を保ちながら、資料由来の情報を適切に配置する。

---

## 入力と出力

### 入力

1. **クライアント資料**
   - プレゼンテーション資料（スライド画像）
   - 会社案内・パンフレット
   - 事業計画書・提案書
   - その他のビジュアル資料（PDF、画像）

2. **既存の整理文書**
   - ヒアリング整理で作成された文書
   - または空の整理文書テンプレート

### 出力

- **更新された整理文書**
  - 資料から抽出した情報が統合されている
  - 出典ページ番号が付記されている（※資料p.X）
  - 既存情報との整合性が確認されている
  - 差分が明示されている

---

## Phase 0: 事前準備

### ユーザーへの確認

```typescript
AskUserQuestion({
  questions: [
    {
      question: "資料の種類を選択してください",
      header: "資料種別",
      options: [
        {
          label: "プレゼンテーション資料",
          description: "スライド形式の説明資料"
        },
        {
          label: "会社案内・パンフレット",
          description: "企業概要や事業内容の紹介資料"
        },
        {
          label: "事業計画書",
          description: "事業戦略や収益計画の資料"
        },
        {
          label: "その他",
          description: "上記以外の資料"
        }
      ],
      multiSelect: false
    },
    {
      question: "既存の整理文書はありますか？",
      header: "既存文書",
      options: [
        {
          label: "あり",
          description: "既存の整理文書を更新します"
        },
        {
          label: "なし",
          description: "テンプレートから新規作成します"
        }
      ],
      multiSelect: false
    }
  ]
});
```

### ファイルの読み込み

```typescript
// 資料ファイル（画像・PDF）
Read({
  file_path: "[ユーザー指定の資料パス]"
});

// 既存の整理文書（ある場合）
Read({
  file_path: "[既存文書パス]"
});
```

---

## Phase 1: 資料の読み取り

### 1-1: テキスト・数値の抽出

資料から以下を抽出:

1. **見出し・タイトル**
   - スライドタイトル
   - セクション名

2. **本文テキスト**
   - 説明文
   - 箇条書き項目

3. **数値データ**
   - 売上、利益、市場規模
   - 成長率、シェア
   - 従業員数、拠点数

4. **固有名詞**
   - 企業名、製品名
   - 人名、役職

### 1-2: 図表の解釈

**グラフ・チャート**:
- 折れ線グラフ: トレンド、推移
- 棒グラフ: 比較、ランキング
- 円グラフ: 構成比、シェア

**表**:
- 行列データを構造化
- 列名、行名を特定

**画像・写真**:
- キャプションを確認
- 文脈から意味を推測

### 1-3: キーメッセージの特定

各スライド・セクションの主張を1文で要約:

**例**:

```
スライドp.3:
- タイトル: 「市場環境の変化」
- 本文: 「EC市場は年率10%成長...」
- グラフ: 市場規模の推移

→ キーメッセージ: 「EC市場は急成長しており、2025年に20兆円規模」
```

---

## Phase 2: 配置先の決定

### 2-1: セクションマッピング

資料の各情報を、既存文書のどのセクションに配置すべきか判定:

| 資料の内容 | 配置先セクション |
|-----------|-----------------|
| 会社概要、沿革 | クライアント情報 |
| 事業内容、製品 | クライアント情報 > 事業内容 |
| 売上、利益 | クライアント情報 or 現状分析 |
| 市場規模、トレンド | 現状分析 or 市場環境 |
| 競合、シェア | 現状分析 > 競合状況 |
| ターゲット層 | ターゲット |
| ブランドコンセプト | ブランドコンセプト（ブランディングPJ） |
| サイト構成 | サイト構成・機能要件（ウェブPJ） |
| ビジネスモデル | ビジネスモデル（ビジネスPJ） |

### 2-2: 新規セクションの判断

既存文書に適切なセクションがない場合:

```typescript
AskUserQuestion({
  questions: [
    {
      question: "資料に「XX」という情報がありますが、適切なセクションがありません。どうしますか？",
      header: "配置",
      options: [
        {
          label: "新規セクション作成",
          description: "「XX」セクションを追加"
        },
        {
          label: "既存セクションに追加",
          description: "最も近い既存セクションに配置"
        },
        {
          label: "補足情報として追加",
          description: "補足セクションに配置"
        }
      ],
      multiSelect: false
    }
  ]
});
```

---

## Phase 3: 統合・更新

### 3-1: 既存情報との整合性チェック

資料の情報と既存文書の情報を比較:

**ケース1: 一致している場合**

```markdown
既存: 年商は約5億円 ※ヒアリングより（要確認）
資料: 年商 5億円（2025年実績）※資料p.3より

↓ 統合 ↓

年商: 5億円（2025年実績）
※資料p.3より（ヒアリングでの情報を確認）
```

**ケース2: 詳細化できる場合**

```markdown
既存: ターゲットは30-40代女性 ※ヒアリングより
資料: ターゲット層の詳細（p.8）
      - 年齢: 30-44歳
      - 世帯年収: 600-800万円
      - 居住地: 首都圏60%、地方40%

↓ 統合 ↓

## ターゲット

- 年齢層: 30-44歳
- 性別: 女性
- 世帯年収: 600-800万円
- 居住地: 首都圏60%、地方40%

※資料p.8より（ヒアリングでの概要を詳細化）
```

**ケース3: 矛盾する場合**

```markdown
既存: 予算は500万円 ※ヒアリングより
資料: プロジェクト予算 600万円 ※資料p.12より

↓ 統合 ↓

予算: 600万円
※資料p.12より

---

**矛盾点**:
- ヒアリングでは500万円と聞いていたが、資料では600万円
- 資料の公式情報を優先するが、差異の理由を確認推奨
```

### 3-2: 重複の解消

資料に既存情報と重複する内容がある場合:

- **基本方針**: 資料の情報を優先（公式資料の信頼性が高いため）
- **例外**: ヒアリングで「資料は古い」と言及された場合

**統合例**:

```markdown
既存: 従業員数は約50名 ※ヒアリングより

資料: 従業員数 52名（2025年10月現在）※資料p.2より

↓ 統合 ↓

従業員数: 52名（2025年10月現在）
※資料p.2より
```

### 3-3: 出典ページ番号の付記

資料由来の情報には必ずページ番号を付記:

```markdown
売上高: 5億円（2025年実績）
※資料p.3より（会社説明資料 v2.3）

市場シェア: 15%（業界3位）
※資料p.7 図表より
```

---

## Phase 4: 差分の明示

### 4-1: 追加された情報のハイライト

新たに追加された情報を明示:

```markdown
## クライアント情報

### 企業概要

- 企業名: 株式会社〇〇
- 設立: 2010年
- 従業員数: 52名（2025年10月現在）
- **事業内容**: EC事業、マーケティング支援事業 ✨NEW
- **主要取引先**: A社、B社、C社 ✨NEW

※資料p.2より（✨NEWは今回資料から追加）
```

### 4-2: 変更された情報の履歴

重要な変更は履歴として記録:

```markdown
## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| 2026-01-20 | 初版作成（ヒアリングメモより） |
| 2026-01-23 | 会社説明資料から以下を追加: <br> - 企業概要の詳細（p.2）<br> - 市場シェアデータ（p.7）<br> - 予算を500万円→600万円に修正（p.12） |
```

---

## Phase 5: 出力生成

### 5-1: 更新された整理文書の出力

```typescript
Write({
  file_path: "[既存文書パス]",
  content: "[更新されたドキュメント]"
});
```

### 5-2: 差分レポートの生成

ユーザーへのフィードバック用に差分をまとめる:

```markdown
## 📊 資料統合が完了しました

### 統合された資料

- **資料名**: 会社説明資料 v2.3
- **ページ数**: 15ページ
- **資料種別**: プレゼンテーション資料

### 追加された情報

1. **クライアント情報**（p.2）
   - 事業内容の詳細
   - 主要取引先リスト

2. **現状分析**（p.7）
   - 市場シェアデータ
   - 競合比較表

3. **目的・ゴール**（p.12）
   - KPI目標値

### 修正された情報

- 予算: 500万円 → 600万円（※資料p.12で確認）

### 矛盾点

以下の点でヒアリング情報と資料情報が異なりました:
- [ ] 予算の差異（500万円 vs 600万円）→ 理由を確認推奨

### 次のステップ

1. 更新された整理文書を確認
2. 矛盾点の確認（必要に応じて）
3. さらに資料があれば追加統合
```

---

## Phase 6: 資料の整理

### 資料ファイルの管理

統合後、資料ファイルをプロジェクトディレクトリに整理:

```
project-name/
├── hearing-document.md        # 整理文書
├── summary.md                 # サマリー
└── materials/                 # 資料フォルダ
    ├── company-profile-v2.3.pdf
    ├── slide-01.png
    ├── slide-02.png
    └── ...
```

### 資料一覧の更新

整理文書の「参考資料」セクションを更新:

```markdown
## 補足情報

### 参考資料

- 会社説明資料 v2.3（2025-10作成）
  - ファイル: `materials/company-profile-v2.3.pdf`
  - 主な内容: 企業概要、市場分析、事業計画
```

---

## 複数資料の統合

### 資料の優先順位

複数の資料で情報が異なる場合の判断基準:

1. **最新の資料**（作成日・バージョンが新しい）
2. **公式性が高い資料**（会社案内 > 提案書）
3. **詳細度が高い資料**（具体的な数値がある）

### 逐次統合

資料が複数ある場合は、1つずつ統合:

```
1. ヒアリングメモ整理 → 初版文書
2. 資料A統合 → 文書v2
3. 資料B統合 → 文書v3
4. ...
```

---

## エラーハンドリング

### 資料が読み取れない場合

```typescript
AskUserQuestion({
  questions: [
    {
      question: "資料の一部が読み取れませんでした。どうしますか？",
      header: "対応",
      options: [
        {
          label: "スキップ",
          description: "読み取れた部分のみ統合"
        },
        {
          label: "手動入力",
          description: "読み取れなかった情報を教えてください"
        },
        {
          label: "再試行",
          description: "別の方法で資料を提供してください"
        }
      ],
      multiSelect: false
    }
  ]
});
```

### 配置先が不明な場合

```typescript
AskUserQuestion({
  questions: [
    {
      question: "資料p.Xの情報「XX」の配置先が不明です。どのセクションに配置しますか？",
      header: "配置先",
      options: [
        { label: "セクションA", description: "..." },
        { label: "セクションB", description: "..." },
        { label: "新規セクション作成", description: "..." },
        { label: "スキップ", description: "この情報は統合しない" }
      ],
      multiSelect: false
    }
  ]
});
```

---

## チェックリスト

資料統合完了前に確認:

- [ ] 資料の全ページが確認されている
- [ ] 抽出された情報が適切なセクションに配置されている
- [ ] 出典ページ番号が付記されている
- [ ] 既存情報との整合性が確認されている
- [ ] 矛盾点が明記されている
- [ ] 追加・変更された情報が明示されている
- [ ] 資料ファイルが整理されている
- [ ] 更新履歴が記録されている

---

## まとめ

このワークフローは、クライアント資料から情報を抽出し、既存の整理文書に統合するプロセス。
資料の公式性を活かしながら、既存情報との整合性を保ち、信頼性の高いドキュメントを維持する。
複数資料の逐次統合により、プロジェクト理解を段階的に深めることができる。
