# セキュリティ監査 チェックリスト

## A01: アクセス制御の不備

### エンドポイントレベル

- [ ] すべてのエンドポイントで認証チェックが実装されている
- [ ] 保護されるべきリソースに未認証アクセスが可能になっていない
- [ ] 他のユーザーのリソースに直接アクセスできない（水平権限昇格）
- [ ] 権限のないユーザーが高度な機能にアクセスできない（垂直権限昇格）

### セッション管理

- [ ] セッションIDが予測不可能（十分な長さとランダム性）
- [ ] セッションタイムアウトが設定されている
- [ ] セッション固定攻撃対策が実装されている
- [ ] ログアウト後にセッションが無効化される

### デフォルト拒否原則

- [ ] デフォルトは拒否で、明示的に許可する設計
- [ ] 権限なしのユーザーは最小限のリソースのみアクセス可能

---

## A02: 暗号化の失敗

### データ保護

- [ ] パスワードは bcrypt/Argon2 で安全にハッシュ化
- [ ] 個人識別情報（PII）が暗号化されている
- [ ] API キーと機密情報が暗号化されている
- [ ] ハードコードされた機密情報がない

### 通信セキュリティ

- [ ] HTTPS のみが使用されている（HTTP は禁止）
- [ ] TLS 1.2 以上が使用されている
- [ ] 自己署名証明書は本番環境では使用されていない
- [ ] SSL ストリッピング攻撃対策（HSTS）が実装されている

### データベース暗号化

- [ ] センシティブなデータベース列が暗号化されている
- [ ] 暗号化キーが安全に管理されている

---

## A03: インジェクション

### SQL インジェクション

- [ ] パラメータ化クエリが使用されている
- [ ] ORMが適切に使用されている
- [ ] ユーザー入力の直接クエリへの埋め込みがない
- [ ] データベースエラーが画面に表示されていない

### NoSQL インジェクション

- [ ] NoSQL クエリがパラメータ化されている
- [ ] 操作子（$where など）の使用が制限されている

### コマンドインジェクション

- [ ] OS コマンド実行で `exec()` や `system()` が使用されていない
- [ ] どうしても必要な場合は、入力が厳密に検証されている

### テンプレートインジェクション

- [ ] テンプレート変数が安全にエスケープされている
- [ ] ユーザー入力がテンプレート処理に直接渡されていない

---

## A04: 安全でない設計

### 脅威モデリング

- [ ] 脅威モデルが作成・文書化されている
- [ ] リスク評価が実施されている
- [ ] 設計レビューが行われている

### 多層防御

- [ ] 複数のセキュリティレイヤーが実装されている
- [ ] 単一の防御に依存していない

---

## A05: セキュリティの誤構成

### デフォルト設定

- [ ] デフォルトの認証情報が変更されている
- [ ] 不要なサービス/ポートが無効化されている

### セキュリティヘッダー

- [ ] Content-Security-Policy (CSP) が設定されている
- [ ] X-Frame-Options で Clickjacking 対策がされている
- [ ] X-Content-Type-Options で MIME スニッフィング対策がされている
- [ ] Strict-Transport-Security (HSTS) が設定されている

### エラーメッセージ

- [ ] 詳細なエラーメッセージがユーザーに表示されていない
- [ ] システム情報がエラーレスポンスに含まれていない

### デバッグモード

- [ ] 本番環境でデバッグモードが無効化されている
- [ ] スタックトレースが本番で表示されていない

---

## A06: 脆弱で古いコンポーネント

### 依存関係管理

- [ ] `npm audit` / `pip check` で脆弱性チェック完了
- [ ] 依存関係が最新版に更新されている
- [ ] 脆弱性のあるバージョンが使用されていない

### ライブラリ監視

- [ ] Snyk / Dependabot などのツールで監視されている
- [ ] セキュリティアップデートが定期的に適用されている

---

## A07: 識別と認証の失敗

### パスワード

- [ ] 最小文字数要件（12文字以上推奨）
- [ ] 複雑性要件（大文字、小文字、数字、記号）
- [ ] パスワード再利用制限
- [ ] パスワード有効期限（90日程度）

### 多要素認証（MFA）

- [ ] MFA が実装されている（特に管理者アカウント）
- [ ] SMS以外の方法（TOTP）が利用可能

### ブルートフォース対策

- [ ] ログイン試行の制限が実装されている
- [ ] アカウントロック機構がある

### セッション管理

- [ ] セッション ID が予測不可能
- [ ] セッション有効期限が設定されている
- [ ] 並行セッション数が制限されている

---

## A08: ソフトウェアとデータの整合性

### デシリアライゼーション

- [ ] ユーザー入力のデシリアライゼーション制限
- [ ] 既知の安全なシリアライゼーション形式のみ使用（JSON など）

### CI/CD セキュリティ

- [ ] コードリポジトリへのアクセス制限
- [ ] デプロイパイプラインの認証・認可
- [ ] アーティファクト署名の検証

---

## A09: セキュリティログと監視

### ログ記録

- [ ] ログイン試行（成功/失敗）が記録されている
- [ ] アクセス制御の失敗がログされている
- [ ] 機密データアクセスが監査ログされている
- [ ] 管理者操作がログされている

### ログ保護

- [ ] ログが改ざんから保護されている
- [ ] ログが十分な期間保存されている（最低90日）

### 監視とアラート

- [ ] 異常アクセスパターンを検出するアラート
- [ ] レート制限違反アラート
- [ ] エラーレート上昇アラート

---

## A10: サーバーサイドリクエストフォージェリ（SSRF）

### URLバリデーション

- [ ] ユーザーが指定した URL がホワイトリストに対して検証されている
- [ ] プライベート IP アドレス（127.0.0.1、10.0.0.0/8 など）へのアクセスが制限されている
- [ ] メタデータサービス（AWS EC2 など）へのアクセスが制限されている

### リダイレクト対策

- [ ] リダイレクト先が検証されている
- [ ] オープンリダイレクト脆弱性がない

---

## その他の重要なチェック項目

### クロスサイトスクリプティング（XSS）

- [ ] ユーザー入力がコンテキストに応じてエスケープされている
- [ ] JavaScript テンプレートが適切にエスケープされている
- [ ] DOM XSS 対策が実装されている

### クロスサイトリクエストフォージェリ（CSRF）

- [ ] CSRF トークンが実装されている（状態変化操作）
- [ ] SameSite Cookie 属性が設定されている

### セキュアなクッキー設定

- [ ] Secure フラグが設定されている
- [ ] HttpOnly フラグが設定されている
- [ ] SameSite が Strict または Lax に設定されている

### レート制限

- [ ] API レート制限が実装されている
- [ ] 認証なしエンドポイントも制限されている

---

## 監査後のアクション

**重大度別対応タイムライン:**

| 重大度 | 対応期限 |
|-------|---------|
| Critical | 即日 |
| High | 24時間以内 |
| Medium | 1週間以内 |
| Low | 次回リリース |

- [ ] 指摘事項が修正される
- [ ] 修正がコードレビューされる
- [ ] テストで修正確認される
- [ ] 本番へのデプロイ後も監視される
