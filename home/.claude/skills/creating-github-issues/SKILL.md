# GitHub Issue 作成スキル

## 役割

技術調査の結果や会話の内容を、構造化された GitHub/GitLab Issue に変換する。タイトル、概要、詳細、完了条件、実装上の注意点、ブランチ名提案を含むテンプレートに基づいて Issue を生成する。

---

## 目的

技術調査後の実装タスクを即座に構造化された Issue として記録し、チーム開発でのタスク管理を効率化する。一貫性のあるフォーマットで Issue を作成することで、レビュー効率とチームコミュニケーションを向上させる。

---

## 出力テンプレート

### 1. タイトル

簡潔かつ具体的なタイトル（50文字以内）。

**フォーマット:**
```
[カテゴリ] 機能名/修正内容
```

**例:**
```
[Feature] ユーザープロフィール編集機能の実装
[Fix] 認証トークン有効期限切れ時のエラーハンドリング
[Refactor] API レスポンスキャッシュ機構の最適化
```

### 2. 概要

Issue の目的を2〜3文で説明する。「何を」「なぜ」「どうする」を明確に。

**例:**
```
現在、ユーザーはプロフィール情報を編集できない。ユーザー体験向上のため、
プロフィール編集機能を実装する。画像アップロード、基本情報更新、
バリデーション機能を含む。
```

### 3. 詳細

実装の具体的な内容を段落形式で記述する。過度な箇条書きは避け、流れのある文章で説明する。

**記載項目:**
- 現状の問題点
- 実装する機能の詳細
- 技術スタック（使用するライブラリ・API等）
- UI/UX の考慮事項

### 4. 完了条件

チェックリスト形式で、実装が完了したと判断する基準を列挙する。

**フォーマット:**
```markdown
完了条件：
- [ ] プロフィール編集フォームのUI実装
- [ ] バリデーションロジックの実装
- [ ] API エンドポイントの実装
- [ ] ユニットテスト実装（カバレッジ 80% 以上）
- [ ] E2E テスト実装
- [ ] ドキュメント更新
```

### 5. 実装上の注意点

実装時に気をつけるべき点、既知の制約、セキュリティ考慮事項等を記述する。

**例:**
```
実装上の注意点：

画像アップロード機能では、ファイルサイズ制限（5MB）とファイル形式チェック
（JPEG、PNG、WebP のみ）を実装する。XSS 対策として、ユーザー入力は全て
サニタイズする。プロフィール更新時は楽観的ロックを使用し、
同時更新の競合を防ぐ。
```

### 6. 対応ブランチ名の提案

Git Flow に基づいたブランチ名を提案する。

**フォーマット:**
```
feature/user-profile-edit
fix/auth-token-expiry
refactor/api-cache-optimization
```

---

## 実行フロー

### Step 1: 情報収集

ユーザーとの会話から以下の情報を抽出または質問する：

- **実装内容**: 何を作るのか
- **目的**: なぜ必要なのか
- **技術詳細**: どのように実装するのか
- **制約条件**: 期限、技術的制約、既存システムとの互換性

不足している情報は `AskUserQuestion` で確認する。

### Step 2: テンプレートに基づいて生成

上記の出力テンプレートに従い、構造化された Issue を生成する。

### Step 3: ラベルとマイルストーンの提案（オプション）

適切なラベル（`bug`、`enhancement`、`documentation` 等）とマイルストーンを提案する。

---

## ガイドライン

### 散文的な文章を優先

詳細セクションでは、箇条書きではなく段落形式で記述する。ただし、完了条件はチェックリスト形式でOK。

**Good（段落形式）:**

```
画像アップロード機能では、ユーザーが JPEG、PNG、WebP 形式の画像を
アップロードできる。ファイルサイズは 5MB 以下に制限し、それを超える
場合はエラーメッセージを表示する。
```

**Bad（箇条書き過多）:**

```
画像アップロード機能：
- JPEG、PNG、WebP 対応
- 5MB 以下
- エラーメッセージ表示
```

### タイトルの命名規則

- **機能追加**: `[Feature] 〜を実装`
- **バグ修正**: `[Fix] 〜の問題を修正`
- **リファクタリング**: `[Refactor] 〜を最適化`
- **ドキュメント**: `[Docs] 〜を更新`
- **テスト**: `[Test] 〜のテストを追加`

### 完了条件は具体的に

「実装する」だけでなく、「〜が動作する」「テストが通る」など、検証可能な条件を記載する。

**Good:**

```
- [ ] ユーザーがプロフィール画像を変更でき、変更が即座に反映される
- [ ] ユニットテストが全て通過する（カバレッジ 80% 以上）
```

**Bad:**

```
- [ ] 画像アップロード機能を実装
- [ ] テストを書く
```

---

## 実践例

### 入力（ユーザーとの会話）

```
ユーザー: "認証トークンの有効期限が切れたときのエラーハンドリングが不十分だから修正したい"

Claude: "現在どのような問題が起きていますか？"

ユーザー: "トークンが切れると 401 エラーが返るけど、フロントエンドでハンドリングされてなくて、
ユーザーが何も操作できなくなる。自動的に再ログインさせるか、エラーメッセージを表示したい"

Claude: "実装方針は決まっていますか？それとも提案しましょうか？"

ユーザー: "提案して"
```

### 出力（生成された Issue）

````markdown
# [Fix] 認証トークン有効期限切れ時のエラーハンドリング

## 概要

現在、認証トークンの有効期限が切れると 401 エラーが返されるが、フロントエンドでのエラーハンドリングが不十分であり、ユーザーが操作不能になる問題がある。自動再ログインまたはエラーメッセージ表示によるユーザー体験の改善を実施する。

## 詳細

認証トークンが有効期限切れになると、API から 401 Unauthorized が返される。現在のフロントエンド実装では、このエラーをハンドリングしていないため、ユーザーは何も操作できない状態になる。

実装では、Axios のインターセプターを使用して 401 エラーを検知し、以下の2つのアプローチのいずれかを実装する。

**アプローチ1: リフレッシュトークンによる自動再ログイン**

リフレッシュトークンが有効な場合、自動的に新しいアクセストークンを取得し、失敗したリクエストを再実行する。リフレッシュトークンも無効な場合は、ログイン画面にリダイレクトする。

**アプローチ2: エラーメッセージとログインページへのリダイレクト**

401 エラー時に「セッションが切れました。再度ログインしてください」というメッセージを表示し、3秒後にログインページにリダイレクトする。

いずれのアプローチも、ユーザーがデータ入力中の場合は入力内容を SessionStorage に保存し、再ログイン後に復元する。

## 完了条件

- [ ] Axios インターセプターで 401 エラーをハンドリング
- [ ] リフレッシュトークンによる自動再ログイン機能の実装
- [ ] リフレッシュ失敗時のログインページリダイレクト実装
- [ ] 入力中データの SessionStorage 保存・復元機能
- [ ] エラーメッセージ表示の UI 実装
- [ ] ユニットテスト実装（カバレッジ 80% 以上）
- [ ] E2E テスト実装（トークン期限切れシナリオ）
- [ ] ドキュメント更新（エラーハンドリングフロー図を追加）

## 実装上の注意点

リフレッシュトークンの送信は HTTPS のみで行い、XSS 攻撃対策として HttpOnly Cookie に格納する。複数タブで同時にリフレッシュが発生した場合の競合を防ぐため、ローカルストレージでロックを取得する仕組みを実装する。

SessionStorage に保存するデータには個人情報を含めず、フォーム入力値のみとする。保存データは暗号化し、セキュリティを確保する。

エラーメッセージは多言語対応（日本語・英語）し、i18n ライブラリを使用する。

## 対応ブランチ名

```
fix/auth-token-expiry-handling
```

## ラベル

`bug`, `security`, `UX`

## マイルストーン

Sprint 3
````

---

## 制約

- タイトルは 50 文字以内
- 概要は 2〜3 文
- 詳細セクションは段落形式（箇条書き過多を避ける）
- 完了条件はチェックリスト形式
- ブランチ名は Git Flow に準拠

---

## トリガーキーワード

- 「Issue を作成して」
- 「タスクとして記録して」
- 「GitHub Issue にして」
- 「これを Issue にまとめて」
