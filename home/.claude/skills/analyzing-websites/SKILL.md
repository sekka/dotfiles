---
name: analyzing-websites
description: 既存ウェブサイトを分析し、サイトマップとワイヤーフレームを作成します。URLを渡すとページ構造を解析し、指定形式で出力します。コンテンツ分析機能でページの目的やターゲットも要約できます。
disable-model-invocation: false
---

# ウェブサイト構造分析・ワイヤーフレーム作成

## 概要

指定されたURLからウェブサイトをクロールし、サイトマップ・ワイヤーフレーム・コンテンツ分析を作成する。

## 入力情報の確認

スキル実行時、以下を確認する：

### 1. 対象URL

- トップページのURLを取得
- ドメインを特定（クロール範囲の制限に使用）

### 2. クロール深度

ユーザーに確認：

- **1階層**: トップページから直接リンクされているページのみ
- **2階層**: トップ + その1つ下のページまで
- **3階層以上**: 必要に応じて指定
- **特定ページのみ**: URLリストを手動指定

### 3. サイトマップ出力形式（複数選択可）

- **Mermaid図**: 階層構造をツリー図で視覚化
- **Markdownリスト**: インデント付きリストで構造化
- **JSON**: プログラムで利用しやすい形式

### 4. ワイヤーフレーム出力形式（複数選択可）

- **Markdown + ASCII**: テキストベースで軽量
- **HTML/CSS**: ブラウザで確認可能な実際のワイヤーフレーム

### 5. コンテンツ分析（オプション）

- **なし**: ワイヤーフレームのみ
- **簡易分析**: ページ目的・ターゲット・主要メッセージ
- **詳細分析**: セクション別の目的・要約・キーワード・改善提案

## 実行フロー

### Step 1: サイトクロール

#### 方法A: 事前作成スクリプトを使用（推奨）

**コンテキスト効率的**: 毎回コードを生成せず、既存スクリプトを読み込むだけ

```typescript
// 1. スクリプトを読み込む
Read({
  file_path: "~/.claude/skills/analyzing-websites/scripts/deep-crawl-template.js"
});

// 2. baseUrl と knownPages を編集

// 3. 実行
mcp__plugin_playwright_playwright__browser_run_code({
  code: "... (編集したコード) ..."
});
```

**スクリプトの場所**: `scripts/deep-crawl-template.js`

**詳細**: `scripts/README.md` を参照

#### 方法B: 手動クロール

```text
mcp__plugin_playwright_playwright__browser_navigate
```

**推奨設定**:

- **headlessモード**: 必ず有効化（デフォルト）
  - サーバー環境での実行に適している
  - リソース消費を抑え、高速に動作する

**クロール手順**:

1. トップページにアクセス
2. ページ内のリンクを抽出
3. 同一ドメイン内のリンクをフィルタリング
4. 指定深度まで再帰的にクロール

**除外対象**:

- 外部ドメインへのリンク
- アンカーリンク（#で始まるもの）
- mailto:、tel:、javascript: 等
- 画像・PDF等のファイルリンク
- 重複URL

### Step 2: ページ構造の取得

各ページで以下を実行：

```text
mcp__plugin_playwright_playwright__browser_snapshot
```

スナップショットから抽出する情報：

- ヘッダー構造（h1〜h6）
- ナビゲーション要素
- メインコンテンツエリア
- サイドバー
- フッター
- フォーム要素
- ボタン・リンク
- 画像エリア

### Step 3: サイトマップ生成

#### Mermaid形式

```mermaid
graph TD
    A[トップページ] --> B[会社概要]
    A --> C[サービス]
    A --> D[お問い合わせ]
    C --> C1[サービスA]
    C --> C2[サービスB]
```

#### Markdown形式

```markdown
- トップページ (/)
  - 会社概要 (/about)
  - サービス (/services)
    - サービスA (/services/a)
    - サービスB (/services/b)
  - お問い合わせ (/contact)
```

#### JSON形式

```json
{
  "url": "/",
  "title": "トップページ",
  "children": [
    {
      "url": "/about",
      "title": "会社概要",
      "children": []
    }
  ]
}
```

### Step 4: ワイヤーフレーム生成

#### Markdown + ASCII形式

```markdown
## ページ名: トップページ
URL: https://example.com/

### レイアウト構造

┌─────────────────────────────────────────┐
│ [HEADER]                                │
│ ┌─────┐ ┌─────────────────────────────┐ │
│ │Logo │ │ Nav: Home | About | Contact │ │
│ └─────┘ └─────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [HERO]                                  │
│ ┌─────────────────────────────────────┐ │
│ │ H1: メインキャッチコピー            │ │
│ │ P: サブテキスト説明文               │ │
│ │ [CTA Button]                        │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [MAIN CONTENT]                          │
│ ┌───────────┐ ┌───────────┐ ┌─────────┐ │
│ │ Card 1    │ │ Card 2    │ │ Card 3  │ │
│ │ [Image]   │ │ [Image]   │ │ [Image] │ │
│ │ Title     │ │ Title     │ │ Title   │ │
│ │ Text      │ │ Text      │ │ Text    │ │
│ └───────────┘ └───────────┘ └─────────┘ │
├─────────────────────────────────────────┤
│ [FOOTER]                                │
│ Copyright | Links | SNS Icons           │
└─────────────────────────────────────────┘

### 要素一覧

| エリア | 要素 | 内容 |
|--------|------|------|
| Header | Logo | 会社ロゴ |
| Header | Nav | 5項目のナビゲーション |
| Hero | H1 | メインキャッチコピー |
| Hero | Button | 「詳しく見る」CTA |
| Main | Cards | 3カラムのカード |
```

#### HTML/CSS形式

シンプルなHTMLワイヤーフレームを生成：

- グレースケール配色
- ボックスで要素を表現
- ラベルで要素種別を明示
- レスポンシブ対応（簡易版）

### Step 5: コンテンツ分析（オプション）

コンテンツ分析が選択された場合、以下を生成：

#### 簡易分析

```markdown
## コンテンツ分析サマリー

### ページの目的
[ページが達成しようとしている目標]

### ターゲットユーザー
[想定される読者・利用者]

### 主要メッセージ
> [ページが伝えたいコアメッセージ]
```

#### 詳細分析

```markdown
## コンテンツ分析サマリー

### ページの目的
[ページが達成しようとしている目標]

### ターゲットユーザー
- [ユーザー1]
- [ユーザー2]

### 主要メッセージ
> [ページが伝えたいコアメッセージ]

---

## セクション別コンテンツ分析

### 1. [セクション名]
| 項目 | 内容 |
|------|------|
| **目的** | このセクションの役割 |
| **コンテンツ要約** | 内容の要約（50-100文字） |
| **キーワード** | 重要なキーワード |
| **CTA** | 行動喚起の内容 |
| **差別化ポイント** | 競合との違い（あれば） |

### 2. [セクション名]
...

---

## インサイト・改善提案

### 強み
- [良い点1]
- [良い点2]

### 潜在的な改善点
- [改善提案1]
- [改善提案2]

### UX観点
- [ユーザー体験に関する所見]
```

#### 分析観点

コンテンツ分析では以下の観点で評価：

1. **目的の明確さ**: ページの目的が明確か
2. **ターゲット適合**: 想定ユーザーに適切な内容か
3. **メッセージの一貫性**: 主張が一貫しているか
4. **CTA の効果**: 行動喚起が適切か
5. **情報の構造化**: 情報が整理されているか
6. **差別化**: 競合との違いが伝わるか
7. **信頼性**: 数値・実績・第三者評価の有無

### Step 6: 未探索ページ検証

クロール完了後、以下を検証：

#### 1. 未探索ページの特定

- 全ページで発見したリンクを収集
- 訪問済みURLと比較
- 未訪問のURLをリストアップ

**未探索ページ情報:**

- targetUrl: 未訪問のURL
- linkedFrom: どのページからリンクされているか
- linkText: リンクのテキスト
- wouldBeDepth: 訪問した場合の想定階層

#### 2. 探索率の計算

```
探索率 = 訪問ページ数 / (訪問ページ数 + 未探索ページ数) × 100%
```

**階層別統計:**

- 各階層の訪問ページ数
- 各階層から発見されたリンク数
- 各階層の内部リンク数

#### 3. 階層検証

- 実際の最深階層を特定
- 指定された最大深度との比較
- 第3階層以降が存在しない場合は明記

**検証項目:**

- ✅ 全階層を探索済み
- ⚠️ 未探索ページあり（リンク数と理由を記載）
- ⚠️ 指定深度に到達せず（実際の最深階層を記載）

### Step 7: 出力

指定された形式でファイルを出力：

```
output/
├── sitemap.md              # サイトマップ（Mermaid）
├── sitemap.json            # サイトマップ（JSON）
├── coverage-report.md      # 探索率レポート（NEW）
├── unexplored.md           # 未探索ページリスト（NEW）
├── wireframes/
│   ├── index.md            # トップページ
│   ├── about.md            # 会社概要
│   └── ...
├── wireframes-analyzed/    # 分析付き（詳細分析選択時）
│   ├── index.md
│   └── ...
└── wireframes-html/        # HTML形式の場合
    ├── index.html
    └── ...
```

**coverage-report.md の内容例:**

```markdown
# 探索率レポート

## サマリー

- 訪問ページ数: 27
- 発見した内部リンク: 33
- 未探索ページ: 0
- 探索率: **100%**

## 階層別統計

| 階層 | 訪問ページ数 | 内部リンク数 | 探索状況 |
|------|--------------|--------------|----------|
| 0    | 1            | 26           | ✅ 完了  |
| 1    | 6            | 152          | ✅ 完了  |
| 2    | 20           | 0            | ✅ 完了  |
| 3    | 0            | 0            | - 存在せず |

## 検証結果

✅ 全ページ探索完了
✅ 未探索ページなし
✅ 実際の最深階層: 2階層
```

**unexplored.md の内容例:**

```markdown
# 未探索ページ

## サマリー

未探索ページ数: 5

## 未探索ページリスト

### 1. https://example.com/deep/page1

- **想定階層**: 第4階層
- **リンク元**:
  - https://example.com/page2 (リンクテキスト: "詳細を見る")
  - https://example.com/page3 (リンクテキスト: "もっと見る")

### 2. https://example.com/deep/page2

- **想定階層**: 第4階層
- **リンク元**:
  - https://example.com/page4 (リンクテキスト: "続きを読む")
```

## 注意事項

- **認証が必要なページ**: クロール不可。公開ページのみ対象
- **403 Forbiddenエラー**:
  - WebFetchで403が返された場合、Playwrightで再試行
  - Playwrightでも403の場合、「アクセス不可」として記録
  - サイトマップに含めず、補足情報として別途記載
- **SPA（Single Page Application）**: 初期表示のみ取得可能
- **動的コンテンツ**: スナップショット時点の状態を取得
- **robots.txt**: 尊重し、disallowされているパスはスキップ
- **レート制限**: ページ間に適度な待機時間を設ける（1-2秒）
- **大規模サイト**: ページ数上限を設定（デフォルト20ページ）

## 出力ディレクトリ

ユーザーに確認するか、デフォルトでプロジェクトルートに `wireframe-output/` を作成。

## クイックスタート例

```
「https://example.com を分析して」

→ 以下を確認：
1. クロール深度: 1階層
2. サイトマップ: Mermaid
3. ワイヤーフレーム: Markdown + ASCII
4. コンテンツ分析: 詳細分析

→ 出力:
- sitemap.md
- wireframes/*.md（レイアウト + 分析付き）
```
