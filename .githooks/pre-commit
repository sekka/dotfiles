#!/bin/bash
set -euo pipefail

# Git pre-commit hook
# mise tasks でlint/formatを実行し、全て成功した場合のみcommitを許可

# mise shims を$PATHに追加（oxlint、oxfmt等のツールにアクセス可能にする）
export PATH="$HOME/.local/share/mise/shims:$PATH"

# カラー定義
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}INFO [Git Hook] commit前のチェックを実行しています...${NC}"
echo ""

# lint チェックの実行
echo -e "${YELLOW}INFO [Git Hook] lint チェック実行中...${NC}"
if bun ~/dotfiles/scripts/development/lint-format.ts --mode=check --verbose; then
  echo -e "${GREEN}SUCCESS [Git Hook] lint チェックが成功しました！commitを続行できます。${NC}"
  exit 0
else
  echo -e "${RED}ERROR [Git Hook] lint チェックが失敗しました。${NC}"
  echo -e "${RED}エラーを修正してからcommitしてください。${NC}"
  exit 1
fi
