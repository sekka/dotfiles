#!/bin/bash
# Git hook: commit-msg
# TypeScript検証関数でコミットメッセージを検証

set -euo pipefail

# Bun ランタイムの確認
if ! command -v bun &>/dev/null; then
	echo "❌ エラー: bun ランタイムが必要です" >&2
	echo "インストール: curl -fsSL https://bun.sh/install | bash" >&2
	exit 1
fi

# プロジェクトルートの取得（symlink 対応）
PROJECT_ROOT="$(git rev-parse --show-toplevel 2>/dev/null)" || {
	echo "❌ エラー: Git リポジトリが見つかりません" >&2
	exit 1
}

# TypeScript検証ツールの確認
VALIDATE_SCRIPT="$PROJECT_ROOT/scripts/git/hooks/validate-commit.ts"
if [[ ! -f "$VALIDATE_SCRIPT" ]]; then
	echo "❌ エラー: 検証スクリプトが見つかりません: $VALIDATE_SCRIPT" >&2
	exit 1
fi

# TypeScript検証ツールを実行
exec bun "$VALIDATE_SCRIPT" "$@"
