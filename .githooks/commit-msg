#!/bin/bash
set -euo pipefail

# Commit message ã« AIç½²åãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
# Git hook: commit-msg

RED='\033[0;31m'
NC='\033[0m' # No Color

# å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
if [[ $# -lt 1 ]]; then
  echo -e "${RED}âŒ ã‚¨ãƒ©ãƒ¼: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“${NC}" >&2
  exit 1
fi

readonly commit_msg_file="$1"

# ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
if [[ ! -f "$commit_msg_file" ]]; then
  echo -e "${RED}âŒ ã‚¨ãƒ©ãƒ¼: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $commit_msg_file${NC}" >&2
  exit 1
fi

# AIç½²åãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆã‚»ã‚­ãƒ¥ã‚¢ãªå®Ÿè£…ï¼‰
# ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚“ã§ã‚³ãƒžãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
if grep -qE 'ðŸ¤– Generated with Claude Code|Co-Authored-By: Claude' "$commit_msg_file" 2>/dev/null; then
  echo -e "${RED}âŒ ã‚¨ãƒ©ãƒ¼: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«AIç½²åãŒå«ã¾ã‚Œã¦ã„ã¾ã™${NC}" >&2
  echo -e "${RED}ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å‰Šé™¤ã—ã¦ãã ã•ã„ï¼š${NC}" >&2
  echo -e "${RED}  - ðŸ¤– Generated with Claude Code${NC}" >&2
  echo -e "${RED}  - Co-Authored-By: Claude${NC}" >&2
  echo "" >&2
  echo "ç¾åœ¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š" >&2
  echo "---" >&2
  cat "$commit_msg_file" >&2
  echo "---" >&2
  exit 1
fi

exit 0
